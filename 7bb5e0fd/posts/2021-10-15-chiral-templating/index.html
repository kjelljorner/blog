<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kjell Jorner">
<meta name="dcterms.date" content="2021-10-15">

<title>The Valence Kjell - Assigning chiral information with SMARTS templates</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NH4YHPCKVD"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NH4YHPCKVD', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="The Valence Kjell - Assigning chiral information with SMARTS templates">
<meta property="og:description" content="How to transform an achiral molecule into a chiral based on a chiral template in RDKit">
<meta property="og:image" content="https://www.valencekjell.com/posts/2021-10-15-chiral-templating/templating.pdf">
<meta property="og:site-name" content="The Valence Kjell">
<meta name="twitter:title" content="The Valence Kjell - Assigning chiral information with SMARTS templates">
<meta name="twitter:description" content="How to transform an achiral molecule into a chiral based on a chiral template in RDKit">
<meta name="twitter:image" content="https://www.valencekjell.com/posts/2021-10-15-chiral-templating/templating.pdf">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <img src="../../shell.png" alt="">
    <span class="navbar-title">The Valence Kjell</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">Kjell Jorner</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kjelljorner"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/kjelljorner"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../subscribe.html"><i class="bi bi-newspaper" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code">Code</a></li>
  <li><a href="#function" id="toc-function" class="nav-link" data-scroll-target="#function">Function</a></li>
  <li><a href="#more-complex-example" id="toc-more-complex-example" class="nav-link" data-scroll-target="#more-complex-example">More complex example</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/kjelljorner/blog/blob/main/posts/2021-10-15-chiral-templating/index.qmd" class="toc-action">View source</a></p><p><a href="https://github.com/kjelljorner/blog/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Assigning chiral information with SMARTS templates</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">How to transform an achiral molecule into a chiral based on a chiral template in RDKit</p>
  <div class="quarto-categories">
    <div class="quarto-category">cheminformatics</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kjell Jorner <a href="https://orcid.org/0000-0002-4191-6790" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 15, 2021</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Molecules can be described with undefined stereochemistry, for example by not specifiying whether a certain stereocenter is R or S. Here, we will investigate how we can fix the stereochemistry of such molecules based on a SMARTS template that matches (parts of) the molecule. This could be a useful trick for example with SMILES strings generated with <a href="https://github.com/aspuru-guzik-group/stoned-selfies">STONED SELFIES</a> that do not (yet) have chiral information.</p>
</section>
<section id="code" class="level1">
<h1>Code</h1>
<p>We import the usual RDKit packages and turn on stereo annotion of the images.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> Chem</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem.Draw <span class="im">import</span> IPythonConsole</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> AllChem</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>IPythonConsole.drawOptions.addStereoAnnotation <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>IPythonConsole.ipython_useSVG<span class="op">=</span><span class="va">True</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First we will generate the molecule without chiral information</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>smiles <span class="op">=</span> <span class="st">"C(Cl)(Br)CC"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mol <span class="op">=</span> Chem.MolFromSmiles(smiles)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>display(mol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<!--?xml version='1.0' encoding='iso-8859-1'?-->
<svg version="1.1" baseprofile="full" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xlink="http://www.w3.org/1999/xlink" space="preserve" width="450px" height="150px" viewbox="0 0 450 150">
<!-- END OF HEADER -->
<rect style="opacity:1.0;fill:#FFFFFF;stroke:none" width="450.0" height="150.0" x="0.0" y="0.0"> </rect>
<path class="bond-0 atom-0 atom-1" d="M 251.8,56.4 L 279.3,40.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-0 atom-0 atom-1" d="M 279.3,40.5 L 306.8,24.6" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-0 atom-2" d="M 251.8,56.4 L 251.8,87.8" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-0 atom-2" d="M 251.8,87.8 L 251.8,119.1" style="fill:none;fill-rule:evenodd;stroke:#7F4C19;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-2 atom-0 atom-3" d="M 251.8,56.4 L 185.9,18.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-3 atom-3 atom-4" d="M 185.9,18.4 L 120.1,56.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="atom-1" d="M 309.3 19.1
Q 309.3 13.8, 311.8 11.0
Q 314.3 8.1, 319.1 8.1
Q 323.5 8.1, 325.9 11.3
L 323.9 12.9
Q 322.2 10.6, 319.1 10.6
Q 315.9 10.6, 314.1 12.8
Q 312.4 15.0, 312.4 19.1
Q 312.4 23.4, 314.2 25.6
Q 316.0 27.7, 319.4 27.7
Q 321.8 27.7, 324.6 26.3
L 325.4 28.6
Q 324.3 29.3, 322.6 29.8
Q 320.9 30.2, 319.0 30.2
Q 314.3 30.2, 311.8 27.3
Q 309.3 24.5, 309.3 19.1
" fill="#00CC00"></path>
<path class="atom-1" d="M 327.1 6.8
L 329.9 6.8
L 329.9 29.9
L 327.1 29.9
L 327.1 6.8
" fill="#00CC00"></path>
<path class="atom-2" d="M 254.9 131.9
Q 257.0 132.4, 258.0 133.7
Q 259.1 135.0, 259.1 136.8
Q 259.1 139.8, 257.2 141.5
Q 255.3 143.2, 251.7 143.2
L 244.5 143.2
L 244.5 121.6
L 250.8 121.6
Q 254.5 121.6, 256.3 123.1
Q 258.2 124.6, 258.2 127.4
Q 258.2 130.6, 254.9 131.9
M 247.3 124.1
L 247.3 130.8
L 250.8 130.8
Q 252.9 130.8, 254.0 130.0
Q 255.2 129.1, 255.2 127.4
Q 255.2 124.1, 250.8 124.1
L 247.3 124.1
M 251.7 140.7
Q 253.8 140.7, 254.9 139.7
Q 256.0 138.7, 256.0 136.8
Q 256.0 135.1, 254.8 134.2
Q 253.6 133.3, 251.2 133.3
L 247.3 133.3
L 247.3 140.7
L 251.7 140.7
" fill="#7F4C19"></path>
<path class="atom-2" d="M 262.8 127.5
L 263.1 129.7
Q 264.8 127.3, 267.4 127.3
Q 268.3 127.3, 269.5 127.6
L 269.0 130.1
Q 267.7 129.8, 267.0 129.8
Q 265.7 129.8, 264.8 130.3
Q 264.0 130.8, 263.3 132.0
L 263.3 143.2
L 260.5 143.2
L 260.5 127.5
L 262.8 127.5
" fill="#7F4C19"></path>
</svg>
</div>
</div>
<p>Our goal is to convert this molecule into the reference below, which has a R configuration of the stereocenter.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>smiles_ref <span class="op">=</span> <span class="st">"Br[C@@H](Cl)CC"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mol_ref <span class="op">=</span> Chem.MolFromSmiles(smiles_ref)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>display(mol_ref)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<!--?xml version='1.0' encoding='iso-8859-1'?-->
<svg version="1.1" baseprofile="full" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xlink="http://www.w3.org/1999/xlink" space="preserve" width="450px" height="150px" viewbox="0 0 450 150">
<!-- END OF HEADER -->
<rect style="opacity:1.0;fill:#FFFFFF;stroke:none" width="450.0" height="150.0" x="0.0" y="0.0"> </rect>
<path class="bond-0 atom-0 atom-1" d="M 251.8,119.1 L 251.8,87.8" style="fill:none;fill-rule:evenodd;stroke:#7F4C19;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-0 atom-0 atom-1" d="M 251.8,87.8 L 251.8,56.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-1 atom-2" d="M 261.2,52.4 L 259.9,50.2" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-1 atom-2" d="M 270.5,48.5 L 268.0,44.1" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-1 atom-2" d="M 279.9,44.5 L 276.1,37.9" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-1 atom-2" d="M 289.3,40.6 L 284.2,31.8" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-1 atom-2" d="M 298.7,36.6 L 292.4,25.6" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-1 atom-2" d="M 308.1,32.6 L 300.5,19.5" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-2 atom-1 atom-3" d="M 251.8,56.4 L 185.9,18.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-3 atom-3 atom-4" d="M 185.9,18.4 L 120.1,56.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="atom-0" d="M 254.9 131.9
Q 257.0 132.4, 258.0 133.7
Q 259.1 135.0, 259.1 136.8
Q 259.1 139.8, 257.2 141.5
Q 255.3 143.2, 251.7 143.2
L 244.5 143.2
L 244.5 121.6
L 250.8 121.6
Q 254.5 121.6, 256.3 123.1
Q 258.2 124.6, 258.2 127.4
Q 258.2 130.6, 254.9 131.9
M 247.3 124.1
L 247.3 130.8
L 250.8 130.8
Q 252.9 130.8, 254.0 130.0
Q 255.2 129.1, 255.2 127.4
Q 255.2 124.1, 250.8 124.1
L 247.3 124.1
M 251.7 140.7
Q 253.8 140.7, 254.9 139.7
Q 256.0 138.7, 256.0 136.8
Q 256.0 135.1, 254.8 134.2
Q 253.6 133.3, 251.2 133.3
L 247.3 133.3
L 247.3 140.7
L 251.7 140.7
" fill="#7F4C19"></path>
<path class="atom-0" d="M 262.8 127.5
L 263.1 129.7
Q 264.8 127.3, 267.4 127.3
Q 268.3 127.3, 269.5 127.6
L 269.0 130.1
Q 267.7 129.8, 267.0 129.8
Q 265.7 129.8, 264.8 130.3
Q 264.0 130.8, 263.3 132.0
L 263.3 143.2
L 260.5 143.2
L 260.5 127.5
L 262.8 127.5
" fill="#7F4C19"></path>
<path class="atom-2" d="M 309.3 19.1
Q 309.3 13.8, 311.8 11.0
Q 314.3 8.1, 319.1 8.1
Q 323.5 8.1, 325.9 11.3
L 323.9 12.9
Q 322.2 10.6, 319.1 10.6
Q 315.9 10.6, 314.1 12.8
Q 312.4 15.0, 312.4 19.1
Q 312.4 23.4, 314.2 25.6
Q 316.0 27.7, 319.4 27.7
Q 321.8 27.7, 324.6 26.3
L 325.4 28.6
Q 324.3 29.3, 322.6 29.8
Q 320.9 30.2, 319.0 30.2
Q 314.3 30.2, 311.8 27.3
Q 309.3 24.5, 309.3 19.1
" fill="#00CC00"></path>
<path class="atom-2" d="M 327.1 6.8
L 329.9 6.8
L 329.9 29.9
L 327.1 29.9
L 327.1 6.8
" fill="#00CC00"></path>
<path class="note" d="M 266.3 70.7
Q 266.3 68.5, 266.9 66.8
Q 267.6 65.0, 268.8 63.0
L 269.6 63.6
Q 268.7 65.4, 268.1 67.0
Q 267.7 68.7, 267.7 70.7
Q 267.7 72.8, 268.1 74.4
Q 268.7 76.0, 269.6 77.9
L 268.8 78.4
Q 267.6 76.5, 266.9 74.7
Q 266.3 72.9, 266.3 70.7
" fill="#000000"></path>
<path class="note" d="M 275.8 75.1
L 273.2 70.6
L 273.2 70.6
L 271.5 70.6
L 271.5 75.1
L 270.0 75.1
L 270.0 64.3
L 273.2 64.3
Q 275.0 64.3, 276.0 65.1
Q 276.9 66.0, 276.9 67.5
Q 276.9 68.6, 276.3 69.4
Q 275.8 70.1, 274.7 70.5
L 277.4 75.1
L 275.8 75.1
M 271.5 69.4
L 273.2 69.4
Q 274.2 69.4, 274.8 68.9
Q 275.4 68.4, 275.4 67.5
Q 275.4 66.5, 274.8 66.0
Q 274.3 65.5, 273.2 65.5
L 271.5 65.5
L 271.5 69.4
" fill="#000000"></path>
<path class="note" d="M 281.1 70.7
Q 281.1 72.9, 280.5 74.7
Q 279.9 76.5, 278.6 78.4
L 277.8 77.9
Q 278.8 76.0, 279.3 74.4
Q 279.8 72.8, 279.8 70.7
Q 279.8 68.7, 279.3 67.0
Q 278.8 65.4, 277.8 63.6
L 278.6 63.0
Q 279.9 65.0, 280.5 66.8
Q 281.1 68.5, 281.1 70.7
" fill="#000000"></path>
</svg>
</div>
</div>
<p>We construct a SMARTS pattern with chiral information that will match the stereocenter. RDKit’s visualization of SMARTS patterns is quite limited, and we could instead use SMARTSView to get a better <a href="https://smarts.plus/smartsview/4768ff0bcafc2fd7217e1f53a3dd2c0cd13fbf17c3b44dd6594b0998480e">view</a>.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>smarts <span class="op">=</span> <span class="st">"[C][C@@H]([Br])[Cl]"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> Chem.MolFromSmarts(smarts)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>display(pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<!--?xml version='1.0' encoding='iso-8859-1'?-->
<svg version="1.1" baseprofile="full" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xlink="http://www.w3.org/1999/xlink" space="preserve" width="450px" height="150px" viewbox="0 0 450 150">
<!-- END OF HEADER -->
<rect style="opacity:1.0;fill:#FFFFFF;stroke:none" width="450.0" height="150.0" x="0.0" y="0.0"> </rect>
<path class="bond-0 atom-1 atom-0" d="M 220.8,93.4 L 187.9,112.4" style="fill:none;fill-rule:evenodd;stroke:#7F7F7F;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-0 atom-1 atom-0" d="M 191.7,119.0 L 158.8,138.0" style="fill:none;fill-rule:evenodd;stroke:#7F7F7F;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-0 atom-1 atom-0" d="M 184.1,105.8 L 151.2,124.8" style="fill:none;fill-rule:evenodd;stroke:#7F7F7F;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-dasharray:2,2"></path>
<path class="bond-1 atom-2 atom-1" d="M 220.8,30.8 L 220.8,62.1" style="fill:none;fill-rule:evenodd;stroke:#7F7F7F;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-2 atom-1" d="M 228.3,62.1 L 228.3,93.4" style="fill:none;fill-rule:evenodd;stroke:#7F7F7F;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-2 atom-1" d="M 213.2,62.1 L 213.2,93.4" style="fill:none;fill-rule:evenodd;stroke:#7F7F7F;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-dasharray:2,2"></path>
<path class="bond-2 atom-1 atom-3" d="M 220.8,93.4 L 248.2,109.3" style="fill:none;fill-rule:evenodd;stroke:#7F7F7F;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-2 atom-1 atom-3" d="M 252.0,102.7 L 279.5,118.6" style="fill:none;fill-rule:evenodd;stroke:#7F7F7F;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-2 atom-1 atom-3" d="M 244.4,115.9 L 271.9,131.7" style="fill:none;fill-rule:evenodd;stroke:#7F7F7F;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-dasharray:2,2"></path>
<path class="atom-2" d="M 223.9 17.0
Q 226.0 17.6, 227.0 18.9
Q 228.1 20.1, 228.1 22.0
Q 228.1 24.9, 226.1 26.6
Q 224.3 28.3, 220.7 28.3
L 213.5 28.3
L 213.5 6.8
L 219.8 6.8
Q 223.5 6.8, 225.3 8.3
Q 227.2 9.8, 227.2 12.5
Q 227.2 15.8, 223.9 17.0
M 216.3 9.2
L 216.3 16.0
L 219.8 16.0
Q 221.9 16.0, 223.0 15.1
Q 224.1 14.3, 224.1 12.5
Q 224.1 9.2, 219.8 9.2
L 216.3 9.2
M 220.7 25.9
Q 222.8 25.9, 223.9 24.9
Q 225.0 23.9, 225.0 22.0
Q 225.0 20.2, 223.8 19.3
Q 222.6 18.4, 220.2 18.4
L 216.3 18.4
L 216.3 25.9
L 220.7 25.9
" fill="#7F4C19"></path>
<path class="atom-2" d="M 231.8 12.7
L 232.1 14.9
Q 233.7 12.4, 236.4 12.4
Q 237.2 12.4, 238.4 12.7
L 237.9 15.3
Q 236.6 15.0, 235.9 15.0
Q 234.6 15.0, 233.8 15.5
Q 233.0 16.0, 232.3 17.2
L 232.3 28.3
L 229.4 28.3
L 229.4 12.7
L 231.8 12.7
" fill="#7F4C19"></path>
<path class="atom-3" d="M 278.2 132.1
Q 278.2 126.8, 280.7 124.0
Q 283.2 121.2, 288.0 121.2
Q 292.4 121.2, 294.8 124.3
L 292.8 125.9
Q 291.0 123.7, 288.0 123.7
Q 284.7 123.7, 283.0 125.8
Q 281.3 128.0, 281.3 132.1
Q 281.3 136.4, 283.0 138.6
Q 284.8 140.8, 288.3 140.8
Q 290.7 140.8, 293.4 139.3
L 294.3 141.6
Q 293.1 142.3, 291.4 142.8
Q 289.7 143.2, 287.9 143.2
Q 283.2 143.2, 280.7 140.3
Q 278.2 137.5, 278.2 132.1
" fill="#00CC00"></path>
<path class="atom-3" d="M 296.0 119.9
L 298.8 119.9
L 298.8 142.9
L 296.0 142.9
L 296.0 119.9
" fill="#00CC00"></path>
<path class="note" d="M 191.4 82.5
Q 191.4 80.3, 192.1 78.5
Q 192.7 76.7, 193.9 74.8
L 194.8 75.3
Q 193.8 77.1, 193.3 78.8
Q 192.8 80.4, 192.8 82.5
Q 192.8 84.5, 193.3 86.2
Q 193.8 87.8, 194.8 89.6
L 193.9 90.2
Q 192.7 88.3, 192.1 86.5
Q 191.4 84.7, 191.4 82.5
" fill="#000000"></path>
<path class="note" d="M 201.0 86.8
L 198.4 82.4
L 198.3 82.4
L 196.6 82.4
L 196.6 86.8
L 195.2 86.8
L 195.2 76.1
L 198.3 76.1
Q 200.2 76.1, 201.1 76.9
Q 202.0 77.7, 202.0 79.2
Q 202.0 80.4, 201.5 81.1
Q 200.9 81.9, 199.8 82.2
L 202.5 86.8
L 201.0 86.8
M 196.6 81.2
L 198.3 81.2
Q 199.4 81.2, 199.9 80.7
Q 200.5 80.2, 200.5 79.2
Q 200.5 78.3, 199.9 77.8
Q 199.4 77.3, 198.3 77.3
L 196.6 77.3
L 196.6 81.2
" fill="#000000"></path>
<path class="note" d="M 206.3 82.5
Q 206.3 84.7, 205.6 86.5
Q 205.0 88.3, 203.8 90.2
L 202.9 89.6
Q 203.9 87.8, 204.4 86.2
Q 204.9 84.5, 204.9 82.5
Q 204.9 80.4, 204.4 78.8
Q 203.9 77.1, 202.9 75.3
L 203.8 74.8
Q 205.0 76.7, 205.6 78.5
Q 206.3 80.3, 206.3 82.5
" fill="#000000"></path>
</svg>
</div>
</div>
<p>We use the <code>GetSubstructMatch</code> method to obtain the atom indices of <code>mol</code> that match the pattern. They will be listed in the order of the atoms in the SMARTS pattern. The display of the Mol object is automatically updated to show the matched atoms.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>match <span class="op">=</span> mol.GetSubstructMatch(pattern)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Matched indices:"</span>, match)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>display(mol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Matched indices: (3, 0, 2, 1)</code></pre>
</div>
<div class="cell-output cell-output-display">
<!--?xml version='1.0' encoding='iso-8859-1'?-->
<svg version="1.1" baseprofile="full" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xlink="http://www.w3.org/1999/xlink" space="preserve" width="450px" height="150px" viewbox="0 0 450 150">
<!-- END OF HEADER -->
<rect style="opacity:1.0;fill:#FFFFFF;stroke:none" width="450.0" height="150.0" x="0.0" y="0.0"> </rect>
<path class="bond-0 atom-0 atom-1" d="M 247.8,57.7 L 309.4,22.2" style="fill:none;fill-rule:evenodd;stroke:#FF7F7F;stroke-width:15.2px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-0 atom-2" d="M 247.8,57.7 L 247.8,128.9" style="fill:none;fill-rule:evenodd;stroke:#FF7F7F;stroke-width:15.2px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-2 atom-0 atom-3" d="M 247.8,57.7 L 186.1,22.2" style="fill:none;fill-rule:evenodd;stroke:#FF7F7F;stroke-width:15.2px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<ellipse cx="247.8" cy="57.7" rx="14.2" ry="14.2" class="atom-0" style="fill:#FF7F7F;fill-rule:evenodd;stroke:#FF7F7F;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></ellipse>
<ellipse cx="311.3" cy="22.3" rx="14.2" ry="15.5" class="atom-1" style="fill:#FF7F7F;fill-rule:evenodd;stroke:#FF7F7F;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></ellipse>
<ellipse cx="252.6" cy="128.9" rx="16.5" ry="14.3" class="atom-2" style="fill:#FF7F7F;fill-rule:evenodd;stroke:#FF7F7F;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></ellipse>
<ellipse cx="186.1" cy="22.2" rx="14.2" ry="14.2" class="atom-3" style="fill:#FF7F7F;fill-rule:evenodd;stroke:#FF7F7F;stroke-width:1.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></ellipse>
<path class="bond-0 atom-0 atom-1" d="M 247.8,57.7 L 273.5,42.9" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-0 atom-0 atom-1" d="M 273.5,42.9 L 299.3,28.0" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-0 atom-2" d="M 247.8,57.7 L 247.8,87.1" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-0 atom-2" d="M 247.8,87.1 L 247.8,116.5" style="fill:none;fill-rule:evenodd;stroke:#7F4C19;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-2 atom-0 atom-3" d="M 247.8,57.7 L 186.1,22.2" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-3 atom-3 atom-4" d="M 186.1,22.2 L 124.5,57.7" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="atom-1" d="M 301.6 22.9
Q 301.6 17.8, 304.0 15.2
Q 306.3 12.6, 310.8 12.6
Q 315.0 12.6, 317.2 15.5
L 315.3 17.0
Q 313.7 14.9, 310.8 14.9
Q 307.8 14.9, 306.1 17.0
Q 304.5 19.0, 304.5 22.9
Q 304.5 26.8, 306.2 28.9
Q 307.9 30.9, 311.1 30.9
Q 313.3 30.9, 315.9 29.6
L 316.7 31.7
Q 315.7 32.4, 314.1 32.8
Q 312.5 33.2, 310.7 33.2
Q 306.3 33.2, 304.0 30.5
Q 301.6 27.9, 301.6 22.9
" fill="#00CC00"></path>
<path class="atom-1" d="M 318.3 11.3
L 320.9 11.3
L 320.9 33.0
L 318.3 33.0
L 318.3 11.3
" fill="#00CC00"></path>
<path class="atom-2" d="M 250.7 128.4
Q 252.6 129.0, 253.6 130.2
Q 254.6 131.3, 254.6 133.1
Q 254.6 135.8, 252.8 137.4
Q 251.1 139.0, 247.7 139.0
L 240.9 139.0
L 240.9 118.8
L 246.9 118.8
Q 250.3 118.8, 252.1 120.2
Q 253.8 121.6, 253.8 124.2
Q 253.8 127.2, 250.7 128.4
M 243.6 121.1
L 243.6 127.4
L 246.9 127.4
Q 248.9 127.4, 249.9 126.6
Q 250.9 125.8, 250.9 124.2
Q 250.9 121.1, 246.9 121.1
L 243.6 121.1
M 247.7 136.7
Q 249.7 136.7, 250.7 135.8
Q 251.8 134.8, 251.8 133.1
Q 251.8 131.4, 250.6 130.6
Q 249.5 129.7, 247.3 129.7
L 243.6 129.7
L 243.6 136.7
L 247.7 136.7
" fill="#7F4C19"></path>
<path class="atom-2" d="M 258.1 124.4
L 258.4 126.4
Q 259.9 124.1, 262.4 124.1
Q 263.2 124.1, 264.3 124.4
L 263.9 126.8
Q 262.7 126.5, 262.0 126.5
Q 260.8 126.5, 260.0 127.0
Q 259.2 127.4, 258.6 128.6
L 258.6 139.0
L 255.9 139.0
L 255.9 124.4
L 258.1 124.4
" fill="#7F4C19"></path>
</svg>
</div>
</div>
<p>The key feature for determining chiral tags in RDKit is the order of the bonds in the Mol object. We will therefore use the following strategy:</p>
<ol type="1">
<li>Reorder the bonds in the Mol object so that they match the order in the SMARTS pattern</li>
<li>Set the chiral tags of each matched atom so that they match the SMARTS pattern</li>
</ol>
<p>First, we find the indices of the bonds in <code>mol</code> that match those in <code>pattern</code>:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>indices_matched <span class="op">=</span> []</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bond <span class="kw">in</span> pattern.GetBonds():</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    i, j <span class="op">=</span> bond.GetBeginAtomIdx(), bond.GetEndAtomIdx()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    bond <span class="op">=</span> mol.GetBondBetweenAtoms(match[i], match[j])</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    indices_matched.append(bond.GetIdx())</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Matched bond indices:"</span>, indices_matched)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Matched bond indices: [2, 1, 0]</code></pre>
</div>
</div>
<p>Then we reorder the bond indices from <code>mol</code> so that the matched bonds (a) come before the unmatched ones and (b) have the same order as in <code>pattern</code></p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>indices_all <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(mol.GetNumBonds()))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>indices_rest <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> indices_all <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> indices_matched]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>indices_new <span class="op">=</span> indices_matched <span class="op">+</span> indices_rest</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rest of bond indices:"</span>, indices_rest)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"New bond index order:"</span>, indices_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rest of bond indices: [3]
New bond index order: [2, 1, 0, 3]</code></pre>
</div>
</div>
<p>To actually reorder the bonds, we need to create an editable <code>RWMol</code> object. We (a) remove all the bonds and then (b) add them back together in the new order.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rw_mol <span class="op">=</span> Chem.RWMol(mol)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>bond_info <span class="op">=</span> []</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bond <span class="kw">in</span> <span class="bu">list</span>(rw_mol.GetBonds()):</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    bond_info.append((bond.GetBeginAtomIdx(), bond.GetEndAtomIdx(), bond.GetBondType()))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    rw_mol.RemoveBond(bond.GetBeginAtomIdx(), bond.GetEndAtomIdx())</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> indices_new:</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    rw_mol.AddBond(<span class="op">*</span>bond_info[i])</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>display(rw_mol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<!--?xml version='1.0' encoding='iso-8859-1'?-->
<svg version="1.1" baseprofile="full" xmlns="http://www.w3.org/2000/svg" xmlns:rdkit="http://www.rdkit.org/xml" xlink="http://www.w3.org/1999/xlink" space="preserve" width="450px" height="150px" viewbox="0 0 450 150">
<!-- END OF HEADER -->
<rect style="opacity:1.0;fill:#FFFFFF;stroke:none" width="450.0" height="150.0" x="0.0" y="0.0"> </rect>
<path class="bond-0 atom-0 atom-3" d="M 251.8,56.4 L 185.9,18.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-0 atom-2" d="M 251.8,56.4 L 251.8,87.8" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-1 atom-0 atom-2" d="M 251.8,87.8 L 251.8,119.1" style="fill:none;fill-rule:evenodd;stroke:#7F4C19;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-2 atom-0 atom-1" d="M 251.8,56.4 L 279.3,40.5" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-2 atom-0 atom-1" d="M 279.3,40.5 L 306.8,24.6" style="fill:none;fill-rule:evenodd;stroke:#00CC00;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="bond-3 atom-3 atom-4" d="M 185.9,18.4 L 120.1,56.4" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"></path>
<path class="atom-1" d="M 309.3 19.1
Q 309.3 13.8, 311.8 11.0
Q 314.3 8.1, 319.1 8.1
Q 323.5 8.1, 325.9 11.3
L 323.9 12.9
Q 322.2 10.6, 319.1 10.6
Q 315.9 10.6, 314.1 12.8
Q 312.4 15.0, 312.4 19.1
Q 312.4 23.4, 314.2 25.6
Q 316.0 27.7, 319.4 27.7
Q 321.8 27.7, 324.6 26.3
L 325.4 28.6
Q 324.3 29.3, 322.6 29.8
Q 320.9 30.2, 319.0 30.2
Q 314.3 30.2, 311.8 27.3
Q 309.3 24.5, 309.3 19.1
" fill="#00CC00"></path>
<path class="atom-1" d="M 327.1 6.8
L 329.9 6.8
L 329.9 29.9
L 327.1 29.9
L 327.1 6.8
" fill="#00CC00"></path>
<path class="atom-2" d="M 254.9 131.9
Q 257.0 132.4, 258.0 133.7
Q 259.1 135.0, 259.1 136.8
Q 259.1 139.8, 257.2 141.5
Q 255.3 143.2, 251.7 143.2
L 244.5 143.2
L 244.5 121.6
L 250.8 121.6
Q 254.5 121.6, 256.3 123.1
Q 258.2 124.6, 258.2 127.4
Q 258.2 130.6, 254.9 131.9
M 247.3 124.1
L 247.3 130.8
L 250.8 130.8
Q 252.9 130.8, 254.0 130.0
Q 255.2 129.1, 255.2 127.4
Q 255.2 124.1, 250.8 124.1
L 247.3 124.1
M 251.7 140.7
Q 253.8 140.7, 254.9 139.7
Q 256.0 138.7, 256.0 136.8
Q 256.0 135.1, 254.8 134.2
Q 253.6 133.3, 251.2 133.3
L 247.3 133.3
L 247.3 140.7
L 251.7 140.7
" fill="#7F4C19"></path>
<path class="atom-2" d="M 262.8 127.5
L 263.1 129.7
Q 264.8 127.3, 267.4 127.3
Q 268.3 127.3, 269.5 127.6
L 269.0 130.1
Q 267.7 129.8, 267.0 129.8
Q 265.7 129.8, 264.8 130.3
Q 264.0 130.8, 263.3 132.0
L 263.3 143.2
L 260.5 143.2
L 260.5 127.5
L 262.8 127.5
" fill="#7F4C19"></path>
</svg>
</div>
</div>
<p>Finally, we set the chiral tags of each matched atom to that of the SMARTS pattern and recover a new <code>Mol</code> object that matches the stereochemistry that we want.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, atom <span class="kw">in</span> <span class="bu">enumerate</span>(pattern.GetAtoms()):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    chiral_tag <span class="op">=</span> atom.GetChiralTag()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    rw_mol.GetAtomWithIdx(match[i]).SetChiralTag(chiral_tag)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>mol_new <span class="op">=</span> rw_mol.GetMol()</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>Chem.SanitizeMol(mol_new)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>Chem.AssignCIPLabels(mol_new)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>Chem.Draw.MolsToGridImage([mol, mol_new, mol_ref], legends<span class="op">=</span>[<span class="st">"Original"</span>, <span class="st">"Templated"</span>, <span class="st">"Reference"</span>], molsPerRow<span class="op">=</span><span class="dv">3</span>, useSVG<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<p><img src="index_files/figure-html/cell-10-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="function" class="level1">
<h1>Function</h1>
<p>Finally we can put everything together in one function:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_chiral_template(mol, pattern):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply SMARTS pattern to Mol</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> mol.GetSubstructMatch(pattern)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find indices of matched bonds in Mol</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    indices_matched <span class="op">=</span> []</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bond <span class="kw">in</span> pattern.GetBonds():</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        i, j <span class="op">=</span> bond.GetBeginAtomIdx(), bond.GetEndAtomIdx()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        bond <span class="op">=</span> mol.GetBondBetweenAtoms(match[i], match[j])</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        indices_matched.append(bond.GetIdx())</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder bond indices to match SMARTS pattern</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    indices_all <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(mol.GetNumBonds()))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    indices_rest <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> indices_all <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> indices_matched]</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    indices_new <span class="op">=</span> indices_matched <span class="op">+</span> indices_rest</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create new Mol. Delete and re-add bonds in new order</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    rw_mol <span class="op">=</span> Chem.RWMol(mol)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    bond_info <span class="op">=</span> []</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bond <span class="kw">in</span> <span class="bu">list</span>(rw_mol.GetBonds()):</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        bond_info.append((bond.GetBeginAtomIdx(), bond.GetEndAtomIdx(), bond.GetBondType()))</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        rw_mol.RemoveBond(bond.GetBeginAtomIdx(), bond.GetEndAtomIdx())</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> indices_new:</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        rw_mol.AddBond(<span class="op">*</span>bond_info[i])</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set chiral tags from template to new Mol</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, atom <span class="kw">in</span> <span class="bu">enumerate</span>(pattern.GetAtoms()):</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        chiral_tag <span class="op">=</span> atom.GetChiralTag()</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        rw_mol.GetAtomWithIdx(match[i]).SetChiralTag(chiral_tag)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recover new Mol</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    new_mol <span class="op">=</span> rw_mol.GetMol()</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    Chem.SanitizeMol(new_mol)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_mol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="more-complex-example" class="level1">
<h1>More complex example</h1>
<p>Now we will use the function on a more complex example with four stereocenters. Note that R and S labels depend on the CIP order of the substituents, which is not defined in terms of the wildcard atom “*”</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>smiles <span class="op">=</span> <span class="st">"CC1C(C)C2CCC1C2"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>mol <span class="op">=</span> Chem.MolFromSmiles(smiles)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>smiles_ref <span class="op">=</span> <span class="st">"C[C@@H]1[C@H](C)[C@H]2CC[C@@H]1C2"</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>mol_ref <span class="op">=</span> Chem.MolFromSmiles(smiles_ref)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>smarts <span class="op">=</span> <span class="st">"[*]-[C@@H]1-[C@H](-[*])-[C@H]2-C-C-[C@@H]1-C2"</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> Chem.MolFromSmarts(smarts)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>Chem.SanitizeMol(pattern) <span class="co"># Needed to avoid bug in MolsToGridImage</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>Chem.Draw.MolsToGridImage([mol, mol_ref, pattern], legends<span class="op">=</span>[<span class="st">"Undefined"</span>, <span class="st">"Defined"</span>, <span class="st">"SMARTS"</span>], useSVG<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<p><img src="index_files/figure-html/cell-12-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>To get the right CIP labels, we need to apply the function <code>AssignCIPLabels</code> but that should not be crucial except for visualization.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mol_new <span class="op">=</span> apply_chiral_template(mol, pattern)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Chem.AssignCIPLabels(mol_new)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>Chem.Draw.MolsToGridImage([mol, mol_new, mol_ref], legends<span class="op">=</span>[<span class="st">"Original"</span>, <span class="st">"Templated"</span>, <span class="st">"Reference"</span>], molsPerRow<span class="op">=</span><span class="dv">3</span>, useSVG<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<p><img src="index_files/figure-html/cell-13-output-1.svg" class="img-fluid"></p>
</div>
</div>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>Code free to use under an MIT license. For citation, use webpage address and access date.</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="kjelljorner/blog-comments" issue-term="pathname" theme="preferred-color-scheme" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb16" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Assigning chiral information with SMARTS templates"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "How to transform an achiral molecule into a chiral based on a chiral template in RDKit"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2021-10-15"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "templating.pdf"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> ["cheminformatics"]</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="an">aliases:</span><span class="co"> ["../../cheminformatics/2021/10/15/Chiral-templating.html"]</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>Molecules can be described with undefined stereochemistry, for example by not specifiying whether a certain stereocenter is R or S. Here, we will investigate how we can fix the stereochemistry of such molecules based on a SMARTS template that matches (parts of) the molecule. This could be a useful trick for example with SMILES strings generated with <span class="co">[</span><span class="ot">STONED SELFIES</span><span class="co">](https://github.com/aspuru-guzik-group/stoned-selfies)</span> that do not (yet) have chiral information.</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># Code</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>We import the usual RDKit packages and turn on stereo annotion of the images.</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> Chem</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem.Draw <span class="im">import</span> IPythonConsole</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> AllChem</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>IPythonConsole.drawOptions.addStereoAnnotation <span class="op">=</span> <span class="va">True</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>IPythonConsole.ipython_useSVG<span class="op">=</span><span class="va">True</span> </span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>First we will generate the molecule without chiral information</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>smiles <span class="op">=</span> <span class="st">"C(Cl)(Br)CC"</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>mol <span class="op">=</span> Chem.MolFromSmiles(smiles)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>display(mol)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>Our goal is to convert this molecule into the reference below, which has a R configuration of the stereocenter.</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>smiles_ref <span class="op">=</span> <span class="st">"Br[C@@H](Cl)CC"</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>mol_ref <span class="op">=</span> Chem.MolFromSmiles(smiles_ref)</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>display(mol_ref)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>We construct a SMARTS pattern with chiral information that will match the stereocenter. RDKit's visualization of SMARTS patterns is quite limited, and we could instead use SMARTSView to get a better <span class="co">[</span><span class="ot">view</span><span class="co">](https://smarts.plus/smartsview/4768ff0bcafc2fd7217e1f53a3dd2c0cd13fbf17c3b44dd6594b0998480e)</span>.</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>smarts <span class="op">=</span> <span class="st">"[C][C@@H]([Br])[Cl]"</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> Chem.MolFromSmarts(smarts)</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>display(pattern)</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>We use the <span class="in">`GetSubstructMatch`</span> method to obtain the atom indices of <span class="in">`mol`</span> that match the pattern. They will be listed in the order of the atoms in the SMARTS pattern. The display of the Mol object is automatically updated to show the matched atoms.</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>match <span class="op">=</span> mol.GetSubstructMatch(pattern)</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Matched indices:"</span>, match)</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>display(mol)</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>The key feature for determining chiral tags in RDKit is the order of the bonds in the Mol object. We will therefore use the following strategy:</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Reorder the bonds in the Mol object so that they match the order in the SMARTS pattern</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Set the chiral tags of each matched atom so that they match the SMARTS pattern</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>First, we find the indices of the bonds in <span class="in">`mol`</span> that match those in <span class="in">`pattern`</span>:</span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>indices_matched <span class="op">=</span> []</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bond <span class="kw">in</span> pattern.GetBonds():</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>    i, j <span class="op">=</span> bond.GetBeginAtomIdx(), bond.GetEndAtomIdx()</span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    bond <span class="op">=</span> mol.GetBondBetweenAtoms(match[i], match[j])</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>    indices_matched.append(bond.GetIdx())</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Matched bond indices:"</span>, indices_matched)</span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>Then we reorder the bond indices from <span class="in">`mol`</span> so that the matched bonds (a) come before the unmatched ones and (b) have the same order as in <span class="in">`pattern`</span></span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>indices_all <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(mol.GetNumBonds()))</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>indices_rest <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> indices_all <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> indices_matched]</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>indices_new <span class="op">=</span> indices_matched <span class="op">+</span> indices_rest</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rest of bond indices:"</span>, indices_rest)</span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"New bond index order:"</span>, indices_new)</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>To actually reorder the bonds, we need to create an editable <span class="in">`RWMol`</span> object. We (a) remove all the bonds and then (b) add them back together in the new order.</span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>rw_mol <span class="op">=</span> Chem.RWMol(mol)</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>bond_info <span class="op">=</span> []</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bond <span class="kw">in</span> <span class="bu">list</span>(rw_mol.GetBonds()):</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>    bond_info.append((bond.GetBeginAtomIdx(), bond.GetEndAtomIdx(), bond.GetBondType()))</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>    rw_mol.RemoveBond(bond.GetBeginAtomIdx(), bond.GetEndAtomIdx())</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> indices_new:</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>    rw_mol.AddBond(<span class="op">*</span>bond_info[i])</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>display(rw_mol)</span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>Finally, we set the chiral tags of each matched atom to that of the SMARTS pattern and recover a new <span class="in">`Mol`</span> object that matches the stereochemistry that we want.</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, atom <span class="kw">in</span> <span class="bu">enumerate</span>(pattern.GetAtoms()):</span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>    chiral_tag <span class="op">=</span> atom.GetChiralTag()</span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>    rw_mol.GetAtomWithIdx(match[i]).SetChiralTag(chiral_tag)</span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>mol_new <span class="op">=</span> rw_mol.GetMol()</span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>Chem.SanitizeMol(mol_new)</span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>Chem.AssignCIPLabels(mol_new)</span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>Chem.Draw.MolsToGridImage([mol, mol_new, mol_ref], legends<span class="op">=</span>[<span class="st">"Original"</span>, <span class="st">"Templated"</span>, <span class="st">"Reference"</span>], molsPerRow<span class="op">=</span><span class="dv">3</span>, useSVG<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a><span class="fu"># Function</span></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>Finally we can put everything together in one function:</span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_chiral_template(mol, pattern):</span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply SMARTS pattern to Mol</span></span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> mol.GetSubstructMatch(pattern)</span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find indices of matched bonds in Mol</span></span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>    indices_matched <span class="op">=</span> []</span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bond <span class="kw">in</span> pattern.GetBonds():</span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>        i, j <span class="op">=</span> bond.GetBeginAtomIdx(), bond.GetEndAtomIdx()</span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>        bond <span class="op">=</span> mol.GetBondBetweenAtoms(match[i], match[j])</span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>        indices_matched.append(bond.GetIdx())</span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder bond indices to match SMARTS pattern</span></span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a>    indices_all <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(mol.GetNumBonds()))</span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a>    indices_rest <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> indices_all <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> indices_matched]</span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>    indices_new <span class="op">=</span> indices_matched <span class="op">+</span> indices_rest</span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create new Mol. Delete and re-add bonds in new order</span></span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>    rw_mol <span class="op">=</span> Chem.RWMol(mol)</span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a>    bond_info <span class="op">=</span> []</span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bond <span class="kw">in</span> <span class="bu">list</span>(rw_mol.GetBonds()):</span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a>        bond_info.append((bond.GetBeginAtomIdx(), bond.GetEndAtomIdx(), bond.GetBondType()))</span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>        rw_mol.RemoveBond(bond.GetBeginAtomIdx(), bond.GetEndAtomIdx())</span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> indices_new:</span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a>        rw_mol.AddBond(<span class="op">*</span>bond_info[i])</span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set chiral tags from template to new Mol</span></span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, atom <span class="kw">in</span> <span class="bu">enumerate</span>(pattern.GetAtoms()):</span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a>        chiral_tag <span class="op">=</span> atom.GetChiralTag()</span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>        rw_mol.GetAtomWithIdx(match[i]).SetChiralTag(chiral_tag)</span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recover new Mol</span></span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a>    new_mol <span class="op">=</span> rw_mol.GetMol()</span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a>    Chem.SanitizeMol(new_mol)</span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_mol</span>
<span id="cb16-176"><a href="#cb16-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-177"><a href="#cb16-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-178"><a href="#cb16-178" aria-hidden="true" tabindex="-1"></a><span class="fu"># More complex example</span></span>
<span id="cb16-179"><a href="#cb16-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-180"><a href="#cb16-180" aria-hidden="true" tabindex="-1"></a>Now we will use the function on a more complex example with four stereocenters. Note that R and S labels depend on the CIP order of the substituents, which is not defined in terms of the wildcard atom "*" </span>
<span id="cb16-181"><a href="#cb16-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-184"><a href="#cb16-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-185"><a href="#cb16-185" aria-hidden="true" tabindex="-1"></a>smiles <span class="op">=</span> <span class="st">"CC1C(C)C2CCC1C2"</span></span>
<span id="cb16-186"><a href="#cb16-186" aria-hidden="true" tabindex="-1"></a>mol <span class="op">=</span> Chem.MolFromSmiles(smiles)</span>
<span id="cb16-187"><a href="#cb16-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-188"><a href="#cb16-188" aria-hidden="true" tabindex="-1"></a>smiles_ref <span class="op">=</span> <span class="st">"C[C@@H]1[C@H](C)[C@H]2CC[C@@H]1C2"</span></span>
<span id="cb16-189"><a href="#cb16-189" aria-hidden="true" tabindex="-1"></a>mol_ref <span class="op">=</span> Chem.MolFromSmiles(smiles_ref)</span>
<span id="cb16-190"><a href="#cb16-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-191"><a href="#cb16-191" aria-hidden="true" tabindex="-1"></a>smarts <span class="op">=</span> <span class="st">"[*]-[C@@H]1-[C@H](-[*])-[C@H]2-C-C-[C@@H]1-C2"</span></span>
<span id="cb16-192"><a href="#cb16-192" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> Chem.MolFromSmarts(smarts)</span>
<span id="cb16-193"><a href="#cb16-193" aria-hidden="true" tabindex="-1"></a>Chem.SanitizeMol(pattern) <span class="co"># Needed to avoid bug in MolsToGridImage</span></span>
<span id="cb16-194"><a href="#cb16-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-195"><a href="#cb16-195" aria-hidden="true" tabindex="-1"></a>Chem.Draw.MolsToGridImage([mol, mol_ref, pattern], legends<span class="op">=</span>[<span class="st">"Undefined"</span>, <span class="st">"Defined"</span>, <span class="st">"SMARTS"</span>], useSVG<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-196"><a href="#cb16-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-197"><a href="#cb16-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-198"><a href="#cb16-198" aria-hidden="true" tabindex="-1"></a>To get the right CIP labels, we need to apply the function <span class="in">`AssignCIPLabels`</span> but that should not be crucial except for visualization.</span>
<span id="cb16-199"><a href="#cb16-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-202"><a href="#cb16-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb16-203"><a href="#cb16-203" aria-hidden="true" tabindex="-1"></a>mol_new <span class="op">=</span> apply_chiral_template(mol, pattern)</span>
<span id="cb16-204"><a href="#cb16-204" aria-hidden="true" tabindex="-1"></a>Chem.AssignCIPLabels(mol_new)</span>
<span id="cb16-205"><a href="#cb16-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-206"><a href="#cb16-206" aria-hidden="true" tabindex="-1"></a>Chem.Draw.MolsToGridImage([mol, mol_new, mol_ref], legends<span class="op">=</span>[<span class="st">"Original"</span>, <span class="st">"Templated"</span>, <span class="st">"Reference"</span>], molsPerRow<span class="op">=</span><span class="dv">3</span>, useSVG<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-207"><a href="#cb16-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
  </div>
</footer>



</body></html>